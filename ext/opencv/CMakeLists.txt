include(ExternalProject)

if (NOT DEPS_LOCATION)
    set(DEPS_LOCATION "${CMAKE_BINARY_DIR}/deps")
endif()

if (NOT OPENCV_LOCATION)
    set(OPENCV_LOCATION "https://github.com/opencv/opencv.git")
endif()

if (TARGET_CROSS)
    ExternalProject_Add(ext.opencv
        DEPENDS envpkg
        GIT_REPOSITORY ${OPENCV_LOCATION}
        GIT_TAG "3.4.10"
        CMAKE_ARGS -DCMAKE_TOOLCHAIN_FILE=${_cross_toolchain_file} -DWITH_GTK=OFF -DENABLE_PRECOMPILED_HEADERS=OFF -DCMAKE_INSTALL_PREFIX=${DEPS_LOCATION} -DWITH_JPEG=ON -DBUILD_JPEG=OFF -DJPEG_INCLUDE_DIR=${DEPS_LOCATION}/include -DJPEG_LIBRARY=${DEPS_LOCATION}/lib/libjpeg.a -DWITH_CUDA=OFF -DWITH_OPENCL=ON -DWITH_OPENGL=ON -DWITH_GSTREAMER=${USE_GST} -DWITH_GSTREAMER_0_10=${USE_GST} -DWITH_IPP=OFF -DWITH_TIFF=OFF -DBUILD_opencv_apps=OFF -DBUILD_DOCS=OFF -DBUILD_TESTS=OFF -DBUILD_PERF_TESTS=OFF -DBUILD_opencv_python2=OFF -DBUILD_opencv_python3=OFF -DWITH_V4L=${USE_V4L} -DWITH_LIBV4L=${USE_V4L} -DENABLE_NEON=${BUILD_ON_ARM}
        PREFIX "${DEPS_LOCATION}"
        INSTALL_DIR "${DEPS_LOCATION}"
        )
else()
    ExternalProject_Add(ext.opencv
        DEPENDS envpkg
        GIT_REPOSITORY ${OPENCV_LOCATION}
        GIT_TAG "3.4.10"
        CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${DEPS_LOCATION} -DBUILD_JPEG=OFF -DWITH_CUDA=ON -DWITH_OPENCL=ON -DWITH_OPENGL=ON -DWITH_IPP=OFF -DWITH_GTK=ON -DWITH_QT=OFF -DBUILD_opencv_apps=OFF -DBUILD_DOCS=OFF -DBUILD_TESTS=OFF -DBUILD_PERF_TESTS=OFF -DBUILD_opencv_python2=OFF -DBUILD_opencv_python3=OFF -DWITH_GSTREAMER=${USE_GST} -DWITH_GSTREAMER_0_10=${USE_GST} -DWITH_V4L=${USE_V4L} -DWITH_LIBV4L=${USE_V4L} -DENABLE_NEON=${BUILD_ON_ARM}
        PREFIX "${DEPS_LOCATION}"
        INSTALL_DIR "${DEPS_LOCATION}"
        )
endif()
